<div  class="overflow-hidden rounded-2xl border border-gray-200 bg-white px-4 pb-3 pt-4 mt-5 dark:border-gray-800 dark:bg-white/3 sm:px-6">
  <div class="flex flex-col gap-2 mb-4 sm:flex-row sm:items-center sm:justify-between">
    <div>
      <h3 class="text-lg font-semibold text-gray-800 dark:text-white/90">
        {{isNew() ? 'Nueva Página' : 'Editar Página'}}
      </h3>

    </div>

    <div class="flex items-center gap-3">

      <button (click)="save('DRAFT')"[disabled]="saving()"
        class="inline-flex items-center gap-2 rounded-lg border border-gray-300 bg-gray-600 px-4 py-2.5 text-theme-sm font-medium text-white shadow-theme-xs hover:bg-gray-50 hover:text-gray-800 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-400 dark:hover:bg-white/[0.03] dark:hover:text-gray-200">
        Guardar Borrador
      </button>

      <button (click)="save('PUBLISHED')"[disabled]="saving()"
        class="inline-flex items-center gap-2 rounded-lg border border-brand-300 bg-brand-600 px-4 py-2.5 text-theme-sm font-medium text-white shadow-theme-xs hover:bg-brand-50 hover:text-brand-800 dark:border-brand-700 dark:bg-brand-800 dark:text-brand-400 dark:hover:bg-white/[0.03] dark:hover:text-brand-200">
        Publicar
      </button>
    </div>
  </div>

  <div class="w-full overflow-x-auto">
  @if (success()) { <app-admin-alert [variant]="'success'" title="Éxito" [message]="success()!" (closed)="success.set(null)" /> }
  <form class="space-y-4" [formGroup]="form" (ngSubmit)="save()">
    <div class="grid md:grid-cols-3 gap-6">
      <div class="md:col-span-2 space-y-4">
        <div>
      <label for="title" class="mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400">Título</label>
      <input id="title" type="text" formControlName="title" class="dark:bg-dark-900 shadow-theme-xs focus:border-brand-300 focus:ring-brand-500/10 dark:focus:border-brand-800 h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 placeholder:text-gray-400 focus:ring-3 focus:outline-hidden dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30" />
    </div>
    <div>
      <label for="excerpt" class="mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400">Excerpt</label>
      <textarea id="excerpt" formControlName="excerpt" rows="3" class="dark:bg-dark-900 shadow-theme-xs focus:border-brand-300 focus:ring-brand-500/10 dark:focus:border-brand-800 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 placeholder:text-gray-400 focus:ring-3 focus:outline-hidden dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30"></textarea>
    </div>
    <div>
          <label class="mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400" for="slug">Slug</label>
          <div class="flex gap-2 items-center">
            <input id="slug" type="text" formControlName="slug" class="dark:bg-dark-900 shadow-theme-xs focus:border-brand-300 focus:ring-brand-500/10 dark:focus:border-brand-800 h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 placeholder:text-gray-400 focus:ring-3 focus:outline-hidden dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30" (blur)="checkSlug()" />
            @if (slugChecking()) { <span class="text-xs text-gray-500">Verificando…</span> }
            @if (slugError()) { <span class="text-xs text-red-600">{{slugError()}}</span> }
          </div>
        </div>
    <div>
      <label for="content" class="mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400">Contenido (HTML permitido)</label>
      <textarea id="content" formControlName="content" rows="14" class="dark:bg-dark-900 shadow-theme-xs focus:border-brand-300 focus:ring-brand-500/10 dark:focus:border-brand-800 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 placeholder:text-gray-400 focus:ring-3 focus:outline-hidden dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30" placeholder="<h2>Título</h2><p>Contenido...</p>"></textarea>
      <p class="mt-1 text-[10px] text-gray-500 dark:text-gray-400">Pega/edita HTML directamente. Se sanitiza al guardar.</p>
    </div>

      </div>
      <div class="space-y-6">
  <fieldset class="border rounded p-3 space-y-3 bg-white dark:bg-gray-800 border-gray-300 dark:border-gray-600 transition-colors">
          <legend class="text-sm font-medium dark:text-gray-400">SEO</legend>
          <div>
            <label class="block text-xs font-medium mb-1 dark:text-gray-200" for="seoTitle">SEO Title</label>
            <input id="seoTitle" type="text" formControlName="seoTitle" class="dark:bg-dark-900 shadow-theme-xs focus:border-brand-300 focus:ring-brand-500/10 dark:focus:border-brand-800 h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 placeholder:text-gray-400 focus:ring-3 focus:outline-hidden dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30" />
          </div>
          <div>
            <label class="block text-xs font-medium mb-1 dark:text-gray-200" for="seoDescription">SEO Description</label>
            <textarea id="seoDescription" rows="2" formControlName="seoDescription" class="dark:bg-dark-900 shadow-theme-xs focus:border-brand-300 focus:ring-brand-500/10 dark:focus:border-brand-800 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 placeholder:text-gray-400 focus:ring-3 focus:outline-hidden dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30"></textarea>
          </div>
          <div>
            <label class="block text-xs font-medium mb-1 dark:text-gray-200" for="seoKeywords">SEO Keywords</label>
            <input id="seoKeywords" type="text" formControlName="seoKeywords" class="dark:bg-dark-900 shadow-theme-xs focus:border-brand-300 focus:ring-brand-500/10 dark:focus:border-brand-800 h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 placeholder:text-gray-400 focus:ring-3 focus:outline-hidden dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30" />
          </div>
        </fieldset>
        <div class="flex items-center gap-2">
          <input id="isHomepage" type="checkbox" formControlName="isHomepage" />
          <label for="isHomepage" class="text-sm dark:text-gray-200">Marcar como homepage</label>
        </div>
        <div class="flex gap-2">
          @if (!isNew() && form.value.slug) { <a [href]="'/pages/' + form.value.slug" target="_blank" rel="noopener" class="text-xs underline dark:text-gray-200">Ver pública</a> }
        </div>
  @if (!isNew()) { <div class="text-xs text-gray-500 dark:text-gray-200">Estado actual: {{form.value.status}}</div> }
  @if (!isNew()) { <button type="button" (click)="deletePage()" class="text-xs text-red-600 underline">Eliminar</button> }
      </div>
    </div>
  </form>
  @if (error()) { <app-admin-alert [variant]="'error'" title="Error" [message]="error()!" (closed)="error.set(null)" /> }
  </div>
</div>
