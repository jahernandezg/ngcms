<div class="overflow-hidden rounded-2xl border border-gray-200 bg-white px-4 pb-3 pt-4 mt-5 dark:border-gray-800 dark:bg-white/3 sm:px-6">
  <div class="flex flex-col gap-2 mb-4 sm:flex-row sm:items-center sm:justify-between">
    <div>
      <h3 class="text-lg font-semibold text-gray-800 dark:text-white/90">Categorías</h3>
    </div>
    <div class="flex items-center gap-3">
      <button type="button" (click)="openCreate()"
        class="inline-flex items-center gap-2 rounded-lg border border-brand-300 bg-white px-4 py-2.5 text-theme-sm font-medium text-brand-700 shadow-theme-xs hover:bg-brand-50 hover:text-brand-800 dark:border-brand-700 dark:bg-brand-800 dark:text-brand-400 dark:hover:bg-white/[0.03] dark:hover:text-brand-200">
        Nueva
      </button>
    </div>
  </div>

  @if (success()) {
  <app-admin-alert [variant]="'success'" title="Éxito" [message]="success()!" (closed)="success.set(null)" />
  }
  @if (error()) {
  <app-admin-alert [variant]="'error'" title="Error" [message]="error()!" (closed)="error.set(null)" />
  }

  <div class="w-full overflow-x-auto">
    <table class="min-w-full">
      <thead>
        <tr class="border-gray-100 border-y dark:border-gray-800">
          <th class="py-3">
            <div class="flex items-center">
              <p class="font-medium text-gray-500 text-theme-xs dark:text-gray-400">Nombre</p>
            </div>
          </th>
          <th class="py-3">
            <div class="flex items-center">
              <p class="font-medium text-gray-500 text-theme-xs dark:text-gray-400">Slug</p>
            </div>
          </th>
          <th class="py-3">
            <div class="flex items-center">
              <p class="font-medium text-gray-500 text-theme-xs dark:text-gray-400">Padre</p>
            </div>
          </th>
          <th class="py-3">
            <div class="flex items-center">
              <p class="font-medium text-gray-500 text-theme-xs dark:text-gray-400">Acciones</p>
            </div>
          </th>
        </tr>
      </thead>
      <tbody class="divide-y divide-gray-100 dark:divide-gray-800">
        @for (c of categories(); track c.id) {
        <tr>
          <td class="py-3">
            <div class="flex items-center">
              <p class="text-gray-500 text-theme-sm dark:text-gray-400">{{c.name}}</p>
            </div>
          </td>
          <td class="py-3">
            <div class="flex items-center">
              <p class="text-gray-500 text-theme-sm dark:text-gray-400">{{c.slug}}</p>
            </div>
          </td>
          <td class="py-3">
            <div class="flex items-center">
              <p class="text-gray-500 text-theme-sm dark:text-gray-400">{{ parentName(c.parentId) || '—' }}</p>
            </div>
          </td>
          <td class="py-3 w-[20px]">
            <div class="flex items-center">
              <div class="inline-flex items-center shadow-theme-xs">
                <button type="button" (click)="startEdit(c.id)"
                  class="-ml-px inline-flex items-center gap-2 bg-transparent px-4 py-3 text-sm font-medium text-brand-500 ring-1 ring-inset ring-brand-500 first:rounded-l-lg last:rounded-r-lg hover:bg-brand-500 hover:text-white">
                  Editar
                </button>
                <button type="button" (click)="remove(c.id)" [appLoading]="busy()" [disabled]="busy()"
                  class="-ml-px inline-flex items-center gap-2 bg-transparent px-4 py-3 text-sm font-medium text-red-500 ring-1 ring-inset ring-red-500 first:rounded-l-lg last:rounded-r-lg hover:bg-red-500 hover:text-white disabled:opacity-40">
                  Eliminar
                </button>
              </div>
            </div>
          </td>
        </tr>
        }

        @if (!svc.loadingCategories() && categories().length===0) {
        <tr>
          <td colspan="4" class="py-3">
            <div class="flex items-center">
              <p class="text-gray-500 text-theme-sm dark:text-gray-400">Sin registros</p>
            </div>
          </td>
        </tr>
        }
        @if (svc.loadingCategories()) {
        <tr>
          <td colspan="4" class="py-8">
            <div class="flex items-center justify-center gap-2 text-gray-500 dark:text-gray-400">
              <app-spinner size="sm" label="Cargando categorías"></app-spinner>
              <span class="text-theme-sm">Cargando…</span>
            </div>
          </td>
        </tr>
        }
      </tbody>
    </table>
  </div>
</div>

@if (formVisible()) {
<div class="fixed inset-0 bg-black/40 flex items-center justify-center p-4">
  <div class="bg-white dark:bg-neutral-800 border border-neutral-200 dark:border-neutral-700 p-4 rounded shadow w-full max-w-md text-neutral-800 dark:text-neutral-100">
  @if (!editingSlug()) {
    <h3 class="font-semibold mb-3">Crear categoría</h3>
    } @else {
    <h3 class="font-semibold mb-3">Editar categoría</h3>
    }

    <form [formGroup]="form" (ngSubmit)="submit()" class="space-y-3">
      <div>
        <label for="cat-name" class="mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400">Nombre</label>
        <input id="cat-name" type="text" formControlName="name"
          class="dark:bg-dark-900 shadow-theme-xs focus:border-brand-300 focus:ring-brand-500/10 dark:focus:border-brand-800 h-11 w-full appearance-none rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 pr-11 text-sm text-gray-800 placeholder:text-gray-400 focus:ring-3 focus:outline-hidden dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30" />
      </div>
      <div>
        <label for="cat-parent" class="mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400">Padre (opcional)</label>
        <select id="cat-parent" formControlName="parentSlug"
          class="dark:bg-dark-900 shadow-theme-xs focus:border-brand-300 focus:ring-brand-500/10 dark:focus:border-brand-800 h-11 w-full appearance-none rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 pr-11 text-sm text-gray-800 placeholder:text-gray-400 focus:ring-3 focus:outline-hidden dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30">
          <option value="" class="text-gray-700 dark:bg-gray-900 dark:text-gray-400">-- Ninguno --</option>
          @for (p of categories(); track p.id) {
          <option [value]="p.slug" class="text-gray-700 dark:bg-gray-900 dark:text-gray-400">{{p.name}}</option>
          }
        </select>
      </div>
      <div class="flex justify-end gap-2 pt-2">
        <button type="button" (click)="close()"
          class="px-3 py-1 rounded-lg border border-gray-300 bg-white px-4 py-2.5 text-theme-sm font-medium text-gray-700 shadow-theme-xs hover:bg-gray-50 hover:text-gray-800 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-400 dark:hover:bg-white/[0.03] dark:hover:text-gray-200">Cancelar</button>
  <button type="submit" [appLoading]="busy()" [disabled]="form.invalid || busy()"
          class="inline-flex items-center gap-2 rounded-lg border border-brand-300 bg-white px-4 py-2.5 text-theme-sm font-medium text-brand-700 shadow-theme-xs hover:bg-brand-50 hover:text-brand-800 disabled:opacity-40 dark:border-brand-700 dark:bg-brand-800 dark:text-brand-400 dark:hover:bg-white/[0.03] dark:hover:text-brand-200">Guardar</button>
      </div>
    </form>
  </div>
</div>
}
